var A=Object.defineProperty,M=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var P=(l,a,t)=>a in l?A(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,h=(l,a)=>{for(var t in a||(a={}))D.call(a,t)&&P(l,t,a[t]);if(B)for(var t of B(a))F.call(a,t)&&P(l,t,a[t]);return l},E=(l,a)=>M(l,R(a));import{R as e,r as k,$ as W}from"./vendor.0fd0999c.js";import{e as T,g as I}from"./index.340d9940.js";const O=l=>{const{element:a,onFinalImage:t}=l,[o,b]=e.useState(""),[n,d]=e.useState({originalWidth:"",originalHeight:"",sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:200,dh:200});e.useEffect(()=>{a.current&&(g(a.current,a.current.naturalWidth,a.current.naturalHeight,null,null,null,null),d(E(h({},n),{originalWidth:a.current.naturalWidth,originalHeight:a.current.naturalHeight})))},[a.current]);function N(s){g(a.current,a.current.naturalWidth,a.current.naturalHeight,n.sx,n.sy,Number(s.target.value),Number(s.target.value)),d(E(h({},n),{sw:Number(s.target.value),sh:Number(s.target.value)}))}function u(s){g(a.current,a.current.naturalWidth,a.current.naturalHeight,n.sx,n.originalHeight/100*Number(s.target.value),n.sw,n.sh),d(E(h({},n),{sy:n.originalHeight/100*Number(s.target.value)}))}function x(s){g(a.current,a.current.naturalWidth,a.current.naturalHeight,n.originalWidth/100*Number(s.target.value),n.sy,n.sw,n.sh),d(E(h({},n),{sx:n.originalWidth/100*Number(s.target.value)}))}function g(s,w,H,C,c,r,i){let m=document.createElement("canvas"),y=m.getContext("2d"),p=w,f=H;m.width=200,m.height=200,y.drawImage(s,C||p/100*(p/200),c||f/100*(f/200),r||p/f*(p/f*1e3),i||p/f*(p/f*1e3),0,0,200,200);let j=m.toDataURL("image/jpeg",.5);t&&t(m),b(j)}function v(){return e.createElement("div",{className:"controller"},e.createElement("h4",null,"You can adjust photo zoom and position"),e.createElement("div",{className:"flex flex-row"},e.createElement("label",{className:"w-85"},"Zoom"),e.createElement("input",{onChange:N,className:"zoom",min:"0",max:"3000",step:"5",type:"range"})),e.createElement("div",null,e.createElement("div",{className:"flex flex-row"},e.createElement("label",{className:"w-85"},"Move	X Axios"),e.createElement("input",{onChange:x,className:"position-x",min:"0",max:"100",step:"1",type:"range"})),e.createElement("div",{className:"flex flex-row"},e.createElement("label",{className:"w-85",htmlFor:""},"Move Y Axios"),e.createElement("input",{onChange:u,className:"position-y",min:"0",max:"100",step:"1",type:"range"}))))}return e.createElement("div",null,o&&e.createElement("div",null,e.createElement("h4",null,"Final Photo"),e.createElement("div",{className:"flex border border-gray-9 w-min"},e.createElement("img",{className:"radius-100",src:o,alt:"resut"}))),a.current&&e.createElement("div",{className:"mt-4"},v()))},S=({onCancel:l,onSuccess:a,whichPhoto:t})=>{const[o,b]=e.useState({name:"",base64:"",canvasBase64:""}),[n,d]=e.useState(),[N,u]=e.useState(""),[x,g]=e.useState(null),v=k.exports.useRef();function s(c){const r=document.createElement("canvas"),i=r.getContext("2d");let m=c.naturalHeight,y=c.naturalWidth;return r.width=t==="avatar"?200:y,r.height=t==="avatar"?200:m,i.drawImage(c,0,0,t==="avatar"?200:y,t==="avatar"?200:m),r}function w(c){let r=c.target.files[0];T(r,i=>{b({name:r.name,base64:i,canvasBase64:""})})}e.useEffect(()=>{if(v.current){let c=s(v.current),r=c.toDataURL("image/jpeg",.5);b(E(h({},o),{canvasBase64:r})),c.toBlob(i=>{d(i)},"image/jpeg",.5)}},[o.base64]);function H(c){if(!n){u("Please Choose a Image");return}if(t==="avatar")if(x){let r=new FormData;x.toBlob(i=>{r.append("avatar",i,o.name),I().post("/api/upload-profile-photo",r).then(m=>{m.status===201&&(u("Your Avatar Photo has been Changed..."),a&&a(m.data.avatar))}).catch(m=>{u("Avatar Upload fail. Try Again")})},"image/jpeg",.5)}else u("Please Choose a Image");else if(n){let r=new FormData;r.append("cover",n,o.name),I().post("/api/upload-profile-cover-photo",r).then(i=>{i.status===201&&(u("Profile cover photo has been changed..."),a&&a(i.data.avatar))}).catch(i=>{u("Profile cover photo upload fail. Try Again")})}else u("Please Choose a Image")}function C(){l&&l()}return e.createElement("div",{className:"flex items-center flex-col overflow-y-auto",style:{maxHeight:"70vh"}},e.createElement("div",null,e.createElement("h1",null,"Choose a profile ",t==="avatar"?"":"cover"," photo"),e.createElement("ul",null,e.createElement("li",null,"for better looking photo ratio should be ",t==="avatar"?"1/1 (square)":"1/4 (landscape)"," ")),N&&e.createElement("div",{className:"bg-red-400 my-4 py-3 px-2 text-white rounded"},e.createElement("p",null,N)),e.createElement("div",{className:"mt-4 mb-2"},e.createElement("input",{className:"",accept:"image/*",onClick:()=>u(""),type:"file",onChange:w})),e.createElement("div",{className:""},o&&o.base64&&e.createElement("div",null,t==="avatar"&&e.createElement("h4",null,"Original Photo"),e.createElement("div",{className:"w-300"},e.createElement("img",{ref:v,className:["w-full",t==="avatar"?"":"hidden"].join(" "),src:o.base64,alt:"profile_photo"}))),o&&o.base64&&t==="avatar"&&e.createElement(O,{onFinalImage:c=>g(c),element:v})),t!=="avatar"&&o.canvasBase64&&e.createElement("div",{className:"flex"},e.createElement("img",{className:"w-full radius-1000",src:o.canvasBase64,alt:"profile_photo"})),e.createElement("div",{className:"mt-4"},e.createElement("button",{onClick:H,className:"btn btn-primary"},"Change ",t==="avatar"?"Profile":"Cover"," Photo"),e.createElement("button",{onClick:C,className:"ml-4 btn btn-primary"},"Cancel"))))};S.propTypes={onCancel:W.func,onSuccess:W.func,whichPhoto:W.oneOf(["cover","avatar"])};export{S as default};
